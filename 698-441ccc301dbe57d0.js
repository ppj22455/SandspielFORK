"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{3139:function(t,n,r){r.d(n,{D:function(){return b}});var e=r(4051),o=r.n(e),a=r(6297),i=r(4093),u=r(8824),l=r(8371),c=r(3901),s=r(2876),d=r(5466),f=r.n(d),p=r(8256),h=r(397);function v(t,n,r,e,o,a,i){try{var u=t[a](i),l=u.value}catch(t){return void r(t)}u.done?n(l):Promise.resolve(l).then(e,o)}function m(t){return function(){var n=this,r=arguments;return new Promise((function(e,o){var a=t.apply(n,r);function i(t){v(a,e,o,i,u,"next",t)}function u(t){v(a,e,o,i,u,"throw",t)}i(void 0)}))}}function y(t,n){if(null==t)return{};var r,e,o=function(t,n){if(null==t)return{};var r,e,o={},a=Object.keys(t);for(e=0;e<a.length;e++)r=a[e],n.indexOf(r)>=0||(o[r]=t[r]);return o}(t,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(e=0;e<a.length;e++)r=a[e],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o}r(7294);var g="https://storage.googleapis.com/sandspiel-studio/creations/";function b(t){return w.apply(this,arguments)}function w(){return w=m(o().mark((function t(n){var r,e,d,f,p,h,v,w=arguments;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=w.length>1&&void 0!==w[1]?w[1]:0,e=n,d=parseInt(e,10),!(isNaN(d)||e.length<1)){t.next=12;break}for(u.oR.getState().setXmls(i.Z),u.oR.setState({expandedPostId:null}),f=[],p=0;p<4;p++)f[p]=!1;for(h=4;h<u.O4;h++)f[h]=!0;return u.oR.setState({disabled:f}),S(),t.abrupt("return");case 12:return v=Date.now(),u.oR.getState().loading||u.oR.setState({curtainColor:"purple"}),u.oR.setState({loading:!0}),u.oR.setState({expandedPostId:d}),t.next=19,fetch("/api/getCreation/"+e).then((function(t){if(u.oR.getState().expandedPostId!==d)return"cancel";if(200==t.status)return t.text();throw console.error("I couldnt' find that data: "+e),"getCreation err"})).then((function(t){if("cancel"===t||u.oR.getState().expandedPostId!==d)return"cancel";var n=JSON.parse(t);console.log("loaded some code from "+e);var r=n.code,o=n.metadata,a=y(n,["code","metadata"]),i=JSON.parse(r).xmls,s=JSON.parse(o),f=s.paused,p=s.disabled,h=s.size,v=s.selectedElement,m=(s.colors,s.color2s,s.elements,s.worldScale),g=void 0===m?.5:m;c.X.includes(g)||(g=.5),e<1436&&(g=.5);var b=Math.round(g*l.bf),w=Math.round(g*l.bf);u.oR.getState().setWorldSize([b,w]),u.n2.worldWidth=b,u.n2.worldHeight=w,u.oR.getState().setWorldScale(g),u.oR.setState({initialWorldSize:b,initialWorldScale:g}),u.oR.setState({paused:!0}),u.oR.setState({initialPaused:f}),u.oR.getState().setXmls(i),u.oR.setState({initialSelected:v,disabled:p,post:a,size:null!=h?h:3}),u.n2.wraparoundEnabled=a.id>938})).catch((function(t){return console.error(t),u.oR.getState().expandedPostId!==d?"cancel":r<5?(console.warn("retrying"),b(n,r+1)):void s.Tb(t)}));case 19:if(u.oR.getState().expandedPostId===d){t.next=21;break}return t.abrupt("return","cancel");case 21:return u.oR.setState({postId:e}),t.next=24,fetch("".concat(g).concat(e,".data.png")).then((function(t){return t.blob()})).then(function(){var t=m(o().mark((function t(n){var r,i,c,s,f,p,h,m,y;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u.oR.getState().expandedPostId===d){t.next=2;break}return t.abrupt("return","cancel");case 2:return t.next=4,n.arrayBuffer();case 4:if(r=t.sent,i=(0,a.Jx)(r).data,c=Date.now(),!((s=c-v)<500)){t.next=11;break}return t.next=11,new Promise((function(t){return setTimeout(t,500-s)}));case 11:if(u.oR.setState({initialSandsData:i}),e>=1436)for(f=0;f<l.bf*l.Cb*4;f++)l.KT[f]=i[f];else for(p=0,h=0,m=0;m<l.bf;m++)for(y=0;y<l.Cb;y++)m<150&&y<150?(l.KT[h]=i[p],l.KT[h+1]=i[p+1],l.KT[h+2]=i[p+2],l.KT[h+3]=i[p+3],h+=4,p+=4):(l.KT[h]=0,l.KT[h+1]=(0,l.tW)(m,y),l.KT[h+2]=0,l.KT[h+3]=0,h+=4);return t.next=15,S(d);case 15:u.oR.setState({loading:!1});case 16:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}());case 24:case"end":return t.stop()}}),t)}))),w.apply(this,arguments)}var S=function(){var t=m(o().mark((function t(){var n,r,e,a,i=arguments;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=i.length>0&&void 0!==i[0]?i[0]:null,r=u.n2.workspace,f().init(r),e=u.oR.getState().setSelected,a=u.oR.getState().elements.length-1;case 5:if(!(a>=0)){t.next=13;break}return e(a),r.clear(),t.next=10,new Promise((function(t){if(u.oR.getState().expandedPostId!==n)return"cancel";var e=function(){(0,h.bB)(a,r),r.removeChangeListener(e),t()};r.addChangeListener(e);var o=u.oR.getState().xmls[a],i=p.Xml.textToDom(o);try{p.Xml.domToWorkspace(i,r)}catch(t){console.error(t)}}));case 10:a--,t.next=5;break;case 13:e(u.oR.getState().initialSelected),u.oR.setState({paused:u.oR.getState().initialPaused});case 15:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},3698:function(t,n,r){r.r(n),r.d(n,{BrowsePostLink:function(){return A},default:function(){return E}});var e=r(4051),o=r.n(e),a=r(5893),i=r(7294),u=r(3299),l=r(2165),c=r(619),s=r(381),d=(r(7743),r(4873)),f=r(1163),p=r(4184),h=r.n(p),v=r(9669),m=r.n(v),y=r(7e3),g=r(8824),b=r(3139),w=r(1262),S=r(8068);function x(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function j(t,n,r,e,o,a,i){try{var u=t[a](i),l=u.value}catch(t){return void r(t)}u.done?n(l):Promise.resolve(l).then(e,o)}function R(t){return function(){var n=this,r=arguments;return new Promise((function(e,o){var a=t.apply(n,r);function i(t){j(a,e,o,i,u,"next",t)}function u(t){j(a,e,o,i,u,"throw",t)}i(void 0)}))}}function P(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var e,o,a=[],i=!0,u=!1;try{for(r=r.call(t);!(i=(e=r.next()).done)&&(a.push(e.value),!n||a.length!==n);i=!0);}catch(t){u=!0,o=t}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(t,n)||function(t,n){if(t){if("string"==typeof t)return x(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(t,n):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var A=function(t){var n,r,e,p,v,x,j,A=t.post,E=t.isReply,O=t.isParent,k=(0,f.useRouter)(),T=(0,u.useSession)().data,D=(0,i.useState)(A),M=D[0],C=D[1],N=(0,i.useState)(!1),I=N[0],Z=N[1],V=(0,i.useState)(!1),F=V[0],W=V[1],L=(0,g.ZP)((function(t){return t.expandedPostId}))===M.id,_=window.innerWidth<=700,H=null==M||null===(n=M._count)||void 0===n?void 0:n.stars,K=(0,i.useState)(null),U=K[0],z=K[1];null!==U&&(H=U);var J=(null==T?void 0:T.userId)&&(null==M||null===(r=M.stars)||void 0===r?void 0:r.length)>0,B=(0,i.useState)(null),X=B[0],Y=B[1];null!==X&&(J=X),"".concat(window.location.protocol,"//").concat(window.location.host,"/post/").concat(M.id);var $=P((0,c.Z)("/media/delete.wav",{volume:.15}),1)[0],q=P((0,c.Z)("/media/block.wav",{volume:.15}),1)[0],G=P((0,d.Kx)({codeHash:d.Zp,userId:d.Zp,featured:d.dJ,admin:(0,d.Wc)(d.dJ,!0),id:d.yz}),2),Q=G[0],tt=(G[1],M.metadata,new Date(M.createdAt).toLocaleDateString());(new Date).getTime()-new Date(M.createdAt).getTime()<6048e5&&(tt=l.WU(M.createdAt));var nt,rt=(0,i.useState)(null),et=rt[0],ot=rt[1],at=(0,i.useState)(null),it=at[0],ut=at[1],lt=(0,i.useState)(null),ct=lt[0],st=lt[1],dt=(0,i.useState)(!1),ft=dt[0],pt=dt[1],ht=(0,i.useState)(!1),vt=(ht[0],ht[1],function(t){t.preventDefault(),t.stopPropagation(),k.push("/user/".concat(M.user.id),void 0,{scroll:!1})});return(0,a.jsxs)("div",{className:"post-family",children:[F&&M.parent&&(0,a.jsx)(S.default,{post:M}),(0,a.jsxs)("div",{className:h()("post",{selected:L,placeholder:M.placeholder}),onClick:function(t){L||($(),g.ZP.setState({post:M}),(0,b.D)(M.id),window.history.replaceState({},document.title,"/post/".concat(M.id).concat(Q.admin?"":"?admin=0")),_&&window.scrollTo(0,0),t.preventDefault())},children:[(0,a.jsxs)("a",{className:"postThumbnail",style:{fontSize:"1rem"},children:[(0,a.jsx)("img",{src:"".concat(y.k).concat(M.id,".gif"),width:300,height:300,style:{display:ft?"block":"none"},onError:function(t){t.target.src.endsWith("gif")&&(t.target.src="".concat(y.k).concat(M.id,".png"))},onMouseEnter:function(t){pt(!0)},onMouseOut:function(t){pt(!1)}}),(0,a.jsx)("img",{src:"".concat(y.k).concat(M.id,".png"),width:300,height:300,style:{display:ft?"none":"block"},onError:function(t){t.target.src.endsWith("gif")&&(t.target.src="".concat(y.k).concat(M.id,".png"))},onMouseEnter:function(t){pt(!0)},onMouseOut:function(t){pt(!1)}})]}),(0,a.jsxs)("div",{className:"browse-info",children:[(0,a.jsxs)("div",{className:"title-container",children:[(0,a.jsxs)("div",{className:"post-header-container",children:[(0,a.jsxs)("div",{className:"userCard",children:[!M.placeholder&&(0,a.jsx)("img",{onClick:vt,className:"pfp",src:null==M||null===(e=M.user)||void 0===e?void 0:e.image}),(0,a.jsxs)("a",{children:[(0,a.jsx)("b",{className:"userName",onClick:vt,children:null!==(nt=null==M||null===(p=M.user)||void 0===p?void 0:p.name)&&void 0!==nt?nt:null==M||null===(v=M.user)||void 0===v||null===(x=v.id)||void 0===x?void 0:x.slice(0,8)}),!M.placeholder&&(0,a.jsx)("div",{className:"timestamp",children:tt})]})]}),!E&&!F&&M.parent&&("admin"===(null==T?void 0:T.role)&&Q.admin||null===M.parent.deletedAt)&&(0,a.jsx)("button",{className:"replies-button",onClick:function(t){t.stopPropagation(),W(!F)},children:_?F?"▼":"▲":"reply to ".concat(F?"▼":"▲")})]}),(0,a.jsx)("div",{className:"title",children:""===M.title?"":'"'.concat(M.title,'"')})]}),L&&"admin"===(null==T?void 0:T.role)&&Q.admin&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("button",{onClick:function(){var t=R(o().mark((function t(n){var r,e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.stopPropagation(),ot(" ..."),t.next=4,m()("/api/update/"+M.id,{params:{featured:!M.featuredAt}});case 4:r=t.sent,(e=r.data).metadata=JSON.parse(e.metadata),C(e),ot("");case 9:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),children:[M.featuredAt?"Unfeature":"Feature",et]}),(0,a.jsxs)("button",{onClick:function(){var t=R(o().mark((function t(n){var r,e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.stopPropagation(),ut(" ..."),t.next=5,m()("/api/update/"+M.id,{params:{public:!M.public}});case 5:r=t.sent,(e=r.data).metadata=JSON.parse(e.metadata),C(e),ut("");case 10:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),children:[!0===M.public?"Make Private":"Make Public",it]}),(0,a.jsxs)("button",{onClick:function(){var t=R(o().mark((function t(n){var r,e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.stopPropagation(),st(" ..."),t.next=5,m()("/api/update/"+M.id,{params:{deleted:!M.deletedAt}});case 5:r=t.sent,(e=r.data).metadata=JSON.parse(e.metadata),C(e),st("");case 10:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),children:[M.deletedAt?"Undelete":"Delete",ct]})]}),(0,a.jsxs)("div",{style:{textAlign:"justify"},children:[L&&T&&(null==M||null===(j=M.user)||void 0===j?void 0:j.id)==T.userId&&(0,a.jsx)("button",{onClick:function(t){t.stopPropagation(),fetch("/api/updateProfile/",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:M.id})}).then((function(t){return t.json()})).then((function(t){window.location.reload()}))},children:"Set this post as my avatar"}),M.featuredAt&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"featured-flag",children:"🏆FEATURED"})]}),M.deletedAt&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"featured-flag",children:"❌DELETED"})]}),(0,a.jsxs)("div",{className:"browse-post-metadata-row",children:[(0,a.jsxs)("span",{children:[(0,a.jsx)(s.default,{starred:J,onClick:function(t){T&&T.userId&&(t.stopPropagation(),q(),z(H+1*(J?-1:1)),Y(!J),fetch("/api/star/"+M.id).then((function(t){return t.json()})).then((function(t){t.metadata=JSON.parse(t.metadata),C(t),Y(null),z(null)})))}}),(0,a.jsx)("span",{style:{zoom:1.25,border:"none",background:"none",marginBottom:0,fontSize:23,marginRight:8},children:M.placeholder?"":H}),!M.placeholder&&(0,a.jsxs)("div",{children:[M.views," plays"]})]}),!O&&!I&&M.children&&M.children.length>0&&(0,a.jsx)("button",{className:"replies-button",onClick:function(t){t.stopPropagation(),Z(!I)},children:_?I?"▲":"▼":"".concat(M.children.length," ").concat(M.children.length>1?"replies":"reply"," ").concat(I?"▲":"▼")})]})]})]})]}),I&&M.children&&(0,a.jsx)(w.Replies,{post:M})]})},E=A},8068:function(t,n,r){r.r(n),r.d(n,{Parent:function(){return h}});var e=r(4051),o=r.n(e),a=r(5893),i=r(9669),u=r.n(i),l=(r(7294),r(8767)),c=r(3698),s=r(4873);function d(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function f(t,n,r,e,o,a,i){try{var u=t[a](i),l=u.value}catch(t){return void r(t)}u.done?n(l):Promise.resolve(l).then(e,o)}function p(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var e,o,a=[],i=!0,u=!1;try{for(r=r.call(t);!(i=(e=r.next()).done)&&(a.push(e.value),!n||a.length!==n);i=!0);}catch(t){u=!0,o=t}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(t,n)||function(t,n){if(t){if("string"==typeof t)return d(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(t,n):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var h=function(t){var n=t.post,r=p((0,s.Kx)({admin:s.dJ}),2),e=r[0],i=(r[1],(0,l.useQuery)(["parentData".concat(n.id)],function(){var t,r=(t=o().mark((function t(r){var a,i,l;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.pageParam,t.next=3,u()("/api/query",{params:{id:n.parent.id,admin:!(!e.admin&&void 0!==e.admin)||void 0}});case 3:return a=t.sent,i=p(a.data.posts,1),(l=i[0]).metadata=JSON.parse(l.metadata),t.abrupt("return",l);case 7:case"end":return t.stop()}}),t)})),function(){var n=this,r=arguments;return new Promise((function(e,o){var a=t.apply(n,r);function i(t){f(a,e,o,i,u,"next",t)}function u(t){f(a,e,o,i,u,"throw",t)}i(void 0)}))});return function(t){return r.apply(this,arguments)}}())),d=i.isLoading,h=i.data;return(0,a.jsxs)("div",{className:"parent-container",children:[d&&(0,a.jsx)("div",{style:{marginBottom:"20px",textAlign:"center"},children:"Loading parent..."}),h&&(0,a.jsx)(c.default,{post:h,full:!0,isParent:!0},void 0===h.key?h.id:h.key)]})};n.default=h},1262:function(t,n,r){r.r(n),r.d(n,{Replies:function(){return v}});var e=r(4051),o=r.n(e),a=r(5893),i=r(9669),u=r.n(i),l=r(7294),c=r(8767),s=r(3698),d=r(4873);function f(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function p(t,n,r,e,o,a,i){try{var u=t[a](i),l=u.value}catch(t){return void r(t)}u.done?n(l):Promise.resolve(l).then(e,o)}function h(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var e,o,a=[],i=!0,u=!1;try{for(r=r.call(t);!(i=(e=r.next()).done)&&(a.push(e.value),!n||a.length!==n);i=!0);}catch(t){u=!0,o=t}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(t,n)||function(t,n){if(t){if("string"==typeof t)return f(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(t,n):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var v=function(t){var n=t.post,r=h((0,d.Kx)({admin:d.dJ}),2),e=r[0],i=(r[1],(0,c.useInfiniteQuery)(["repliesData".concat(n.id),e],function(){var t,r=(t=o().mark((function t(r){var a,i,l,c;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=r.pageParam,i=void 0===a?0:a,t.next=3,u()("/api/query",{params:{order:"new",take:10,skip:i,id:n.id,children:!0,admin:!(!e.admin&&void 0!==e.admin)||void 0}});case 3:return l=t.sent,(c=l.data).posts=c.posts.map((function(t){return t.metadata=JSON.parse(t.metadata),t})),t.abrupt("return",c);case 7:case"end":return t.stop()}}),t)})),function(){var n=this,r=arguments;return new Promise((function(e,o){var a=t.apply(n,r);function i(t){p(a,e,o,i,u,"next",t)}function u(t){p(a,e,o,i,u,"throw",t)}i(void 0)}))});return function(t){return r.apply(this,arguments)}}(),{getPreviousPageParam:function(t){return t.offset||0},getNextPageParam:function(t){return(null==t?void 0:t.offset)||0}})),f=i.isLoading,v=(i.error,i.data);return i.isFetching,i.isFetchingNextPage,i.fetchNextPage,i.hasNextPage,(0,a.jsxs)("div",{className:"replies-container",children:[f&&(0,a.jsx)("div",{style:{marginTop:"20px",textAlign:"center"},children:"Loading replies..."}),null==v?void 0:v.pages.map((function(t,r){return(0,a.jsx)(l.Fragment,{children:t.posts.map((function(t){return(0,a.jsx)(s.default,{post:t,full:!0,isReply:!0},void 0===t.key?t.id:t.key)}))},"replies".concat(n.id,":page").concat(r))}))]})};n.default=v},381:function(t,n,r){r.r(n);var e=r(5893),o=(r(7294),r(5288));function a(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}n.default=function(t){var n=t.starred,r=void 0!==n&&n,i=function(t,n){if(null==t)return{};var r,e,o=function(t,n){if(null==t)return{};var r,e,o={},a=Object.keys(t);for(e=0;e<a.length;e++)r=a[e],n.indexOf(r)>=0||(o[r]=t[r]);return o}(t,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(e=0;e<a.length;e++)r=a[e],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o}(t,["starred"]);return(0,e.jsx)("button",function(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},e=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(r).filter((function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable})))),e.forEach((function(n){a(t,n,r[n])}))}return t}({className:"StarButton ".concat(r?"StarButton--starred":""),type:"button"},i,{children:(0,e.jsx)(o.default,{})}))}},5288:function(t,n,r){r.r(n);var e=r(5893);function o(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function a(){return a=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])}return t},a.apply(this,arguments)}r(7294),n.default=function(t){var n=a({},t);return(0,e.jsx)("svg",function(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},e=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(r).filter((function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable})))),e.forEach((function(n){o(t,n,r[n])}))}return t}({width:32,height:32,fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"StarIcon"},n,{children:(0,e.jsx)("path",{d:"M16 2l3.95 8.563 9.365 1.11-6.924 6.404 1.838 9.25L16 22.72l-8.229 4.606 1.838-9.25-6.924-6.402 9.365-1.11L16 2z"})}))}},7e3:function(t,n,r){r.d(n,{Z:function(){return N},k:function(){return M}});var e=r(5893),o=r(7294),a=r(3299),i=(r(1664),r(4873)),u=r(1163),l=r(8371),c=r(8824),s=r(9060),d=function(t){t=null!==t?t:function(t){throw new TypeError("Cannot destructure undefined")}();var n=(0,c.ZP)((function(t){return t.paused})),r=(0,c.ZP)((function(t){return t.setPaused}));return(0,e.jsxs)("button",{onClick:function(){return r(!n)},className:n?"selected simulation-button play-pause-button":"simulation-button play-pause-button",children:[n?(0,e.jsx)("svg",{height:"15",width:"15",viewBox:"0 0 12 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,e.jsx)("path",{d:"M2 14.5V3.5H3.5V4.5H5V5.5H6.5V6.5H8V7.5H9.5V8.5H10.5V9.5H9.5V10.5H8V11.5H6.5V12.5H5V13.5H3.5V14.5H2Z",fill:"white"})}):(0,e.jsxs)("svg",{height:"13",width:"15",id:"d",viewBox:"0 0 300 300",children:[(0,e.jsx)("polygon",{id:"bar2",points:"0,0 80,0 80,300 0,300"}),(0,e.jsx)("polygon",{id:"bar1",points:"190,0 270,0 270,300 190,300"})]}),n?"Play":"Pause"]})},f=r(619);function p(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}var h=[1.5,3,5,7,19],v=function(t){t=null!==t?t:function(t){throw new TypeError("Cannot destructure undefined")}();var n=(0,c.oR)((function(t){return t.size})),r=(0,c.oR)((function(t){return t.setSize})),o=function(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var e,o,a=[],i=!0,u=!1;try{for(r=r.call(t);!(i=(e=r.next()).done)&&(a.push(e.value),!n||a.length!==n);i=!0);}catch(t){u=!0,o=t}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(t,n)||function(t,n){if(t){if("string"==typeof t)return p(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(t,n):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}((0,f.Z)("/media/clave1.wav",{volume:.05}),1)[0];return(0,e.jsx)("span",{className:"sizes",children:h.map((function(t,a){return(0,e.jsx)("button",{className:"size-button"+(t==n?" selected":""),onClick:function(n){o({playbackRate:2/t}),r(t)},style:{padding:"0px",marginRight:a===h.length-1?2:0,borderTopRightRadius:a<h.length-1?0:"",borderBottomRightRadius:a<h.length-1?0:"",borderTopLeftRadius:a>0?0:"",borderBottomLeftRadius:a>0?0:""},children:(0,e.jsx)("svg",{height:"23",width:"23",id:"d",viewBox:"0 0 100 100",children:(0,e.jsx)("circle",{cx:"50",cy:"50",r:3+t})})},a)}))})},m=r(3901),y=(r(9547),r(4051)),g=r.n(y),b=r(6297),w=r(9669),S=r.n(w),x=r(2395);function j(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function R(t,n,r,e,o,a,i){try{var u=t[a](i),l=u.value}catch(t){return void r(t)}u.done?n(l):Promise.resolve(l).then(e,o)}function P(t){return function(){var n=this,r=arguments;return new Promise((function(e,o){var a=t.apply(n,r);function i(t){R(a,e,o,i,u,"next",t)}function u(t){R(a,e,o,i,u,"throw",t)}i(void 0)}))}}function A(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var e,o,a=[],i=!0,u=!1;try{for(r=r.call(t);!(i=(e=r.next()).done)&&(a.push(e.value),!n||a.length!==n);i=!0);}catch(t){u=!0,o=t}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(t,n)||function(t,n){if(t){if("string"==typeof t)return j(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?j(t,n):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(){var t=/id="([^\\]*?)"/g;return c.oR.getState().xmls.map((function(n){return s.xmlmin(n).replaceAll(t,"")}))}function O(t){for(var n=atob(t.split(",")[1]),r=[],e=0;e<n.length;e++)r.push(n.charCodeAt(e));return new Blob([new Uint8Array(r)],{type:"image/png"})}var k=function(){var t=(0,u.useRouter)(),n=(0,o.useState)(!1),r=n[0],s=n[1],d=A((0,i.Kx)({codeHash:i.Zp,userId:i.Zp,starredBy:i.Zp,order:(0,i.Wc)(i.Zp,"new"),days:i.Zp,featured:(0,i.Wc)(i.dJ,!0),edit:(0,i.Wc)(i.dJ,!1),id:i.yz,admin:i.dJ}),2),f=d[0],p=(d[1],{});void 0!==f.admin&&(p.admin=f.admin);var h=(0,a.useSession)().data,v=(0,o.useState)(""),m=v[0],y=v[1],w=(0,o.useState)(""),j=w[0],R=w[1],k=(0,c.oR)((function(t){return t.post}));(0,o.useEffect)((function(){y("")}),[k]);var T,D,M=function(){var n=P(g().mark((function n(){var r,e,o,a,i,u,s,d=arguments;return g().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=d.length>0&&void 0!==d[0]&&d[0],""===j){n.next=3;break}return n.abrupt("return");case 3:if(" saving..."!==j&&" posting..."!==j&&" ✓ posted"!==j&&" ✓ saved"!==j){n.next=5;break}return n.abrupt("return");case 5:if(R(" preparing..."),h){n.next=10;break}return R("Please sign in to save & post :)"),window.setTimeout((function(){R("")}),3e3),n.abrupt("return");case 10:return n.next=12,new Promise((function(t){return setTimeout(t,35)}));case 12:return e=E(),o=O((0,x.CO)()),n.next=16,(0,x.Th)();case 16:a=n.sent,i=c.oR.getState().postId,console.log(i),u=(0,b.cv)({width:l.bf,height:l.Cb,data:l.KT}),s=new Blob([u]),c.oR.setState({initialSandsData:new Uint8Array(l.KT)}),R(r?" posting...":" saving..."),fetch("/api/upload",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({parentId:i,title:m,metadata:JSON.stringify({paused:c.oR.getState().paused,disabled:c.oR.getState().disabled,elements:c.oR.getState().elements,colors:c.oR.getState().colors,color2s:c.oR.getState().color2s,size:c.oR.getState().size,selectedElement:c.oR.getState().selectedElement,worldScale:c.oR.getState().worldScale},null," "),code:JSON.stringify({xmls:e},null," ")})}).then((function(t){return t.json()})).then(function(){var t=P(g().mark((function t(n){var e,i,u,l,c;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=function(t,n,r){return S().put(t,r,{headers:{"Content-Type":n}})},i=n.dataUploadUrl,u=n.thumbUploadUrl,l=n.gifUploadUrl,t.next=5,Promise.all([e(i,"image/png",s),e(u,"image/png",o),e(l,"image/gif",a)]);case 5:return t.next=7,S()("/api/update/"+n.id,{params:{public:r}});case 7:return c=t.sent,t.abrupt("return",c.data);case 9:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}()).then((function(n){c.oR.setState({post:n,postId:n.id});try{var e=[new ClipboardItem({"text/plain":new Blob([window.location.href],{type:"text/plain"})})];navigator.clipboard.write(e).then((function(){R(r?" ✓ posted":" ✓ saved"),t.push({pathname:"/post/".concat(n.id),query:p})}),(function(t){console.error(t),R("... error")}))}catch(e){R(r?" ✓ posted":" ✓ saved"),t.push({pathname:"/post/".concat(n.id),query:p})}})).finally((function(){window.setTimeout((function(){R("")}),3e3)}));case 24:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),C=null!==(D=null!==(T=null==k?void 0:k.postCount)&&void 0!==T?T:h.postCount)&&void 0!==D?D:0;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("input",{type:"text",placeholder:k?"reply title...":"post title...",value:m,onChange:function(t){return y(t.target.value)}}),(0,e.jsx)("button",{className:"simulation-button postButton",onClick:function(){return M(r)},children:r?"Post ↑":k?"Reply ↑":"Save  ↑"}),(0,e.jsx)("br",{}),(0,e.jsxs)("span",{className:"publicPostToggle",children:[(0,e.jsx)("label",{htmlFor:"publicToggle",children:"Public:"}),(0,e.jsx)("input",{id:"publicToggle",type:"checkbox",disabled:C>2,checked:r,onChange:function(t){return s(!r)}}),(0,e.jsx)("span",{className:"explanation",children:C>2&&"Maximum 3 public posts per 24hrs."})]}),(0,e.jsx)("span",{children:null!=j?j:""})]})};function T(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function D(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var e,o,a=[],i=!0,u=!1;try{for(r=r.call(t);!(i=(e=r.next()).done)&&(a.push(e.value),!n||a.length!==n);i=!0);}catch(t){u=!0,o=t}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(t,n)||function(t,n){if(t){if("string"==typeof t)return T(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?T(t,n):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var M="https://storage.googleapis.com/sandspiel-studio/creations/";function C(){var t=function(){var t=/id="([^\\]*?)"/g;return c.oR.getState().xmls.map((function(n){return s.xmlmin(n).replaceAll(t,"")}))}();return JSON.stringify(t,null," ")}var N=function(){var t,n,r,s,f,p=(0,u.useRouter)(),h=D((0,i.Kx)({edit:(0,i.Wc)(i.dJ,!1),admin:(0,i.Wc)(i.dJ,!0)}),2),y=h[0],g=(h[1],!y.edit),b=(0,a.useSession)().data,w=(0,o.useState)(null),S=w[0],x=w[1],j=(0,c.oR)((function(t){return t.post})),R=(0,c.oR)((function(t){return t.paused})),P=(0,c.oR)((function(t){return t.pos})),A=(0,c.oR)((function(t){return t.elements})),E=4*(P[0]+P[1]*l.bf),O=l.KT[E],T=l.KT[E+1],M=l.KT[E+2],N=l.KT[E+3],I=!1;window.innerWidth<=700&&(I=!0),null==j||null===(t=j._count)||void 0===t||t.stars;var Z=(0,o.useState)(null);Z[0];Z[1],(null==b?void 0:b.userId)&&(null==j||null===(n=j.stars)||void 0===n||n.length);var V,F=(0,o.useState)(null);F[0];return F[1],(0,e.jsxs)("div",{className:"extras-tray",children:[(0,e.jsxs)("div",{className:"controls-row",children:[(0,e.jsxs)("span",{children:[(0,e.jsx)(d,{}),(0,e.jsx)("button",{className:"simulation-button",onClick:function(){(0,l.kW)()},children:"Undo"}),(0,e.jsx)("button",{className:"simulation-button",onClick:function(){(0,l.DT)(),(0,l.Pr)()},children:"Clear"}),R&&(0,e.jsx)("button",{className:"simulation-button",onClick:function(){(0,l.Ky)()},children:"Step"})]}),(0,e.jsx)(v,{})]}),(0,e.jsxs)("div",{className:"controls-row",children:[!I&&(0,e.jsx)("pre",{style:{width:120,height:"1em"},children:void 0!==O&&"".concat(A[O],"\n").concat(T," Color Fade\n").concat(M," Hue Rotate\n").concat(N," Extra")}),(0,e.jsx)(m.Z,{})]}),b?(0,e.jsxs)("div",{children:[j&&(0,e.jsxs)("div",{children:["Replying to"," ",(0,e.jsxs)("a",{onClick:function(){p.push({pathname:"/post/".concat(j.id)})},children:[null!==(V=null==j||null===(r=j.user)||void 0===r?void 0:r.name)&&void 0!==V?V:null==j||null===(s=j.user)||void 0===s||null===(f=s.id)||void 0===f?void 0:f.slice(0,8),"'s post"]})]}),b&&(0,e.jsx)(k,{}),!g&&y.admin&&window.location.host.includes("localhost")&&(0,e.jsxs)("button",{className:"simulation-button",onClick:function(){var t=C(),n=[new ClipboardItem({"text/plain":new Blob([t],{type:"text/plain"})})];navigator.clipboard.write(n).then((function(){x(" ✓")}),(function(){x("...Error")})).finally((function(){window.setTimeout((function(){x(null)}),3e3)}))},children:["Export to Clipboard ",S]})]}):"",(0,e.jsx)("img",{className:"wordmark",src:"/sandspiel.png"})]})}},3901:function(t,n,r){r.d(n,{X:function(){return u}});var e=r(5893),o=(r(7294),r(3658)),a=r(8371),i=r(8824),u=[1/4,.5,1],l=["small","big","MEGA"];n.Z=function(t){t=null!==t?t:function(t){throw new TypeError("Cannot destructure undefined")}();var n=(0,i.oR)((function(t){return t.worldWidth})),r=(0,i.oR)((function(t){return t.setWorldSize})),c=(0,i.oR)((function(t){return t.setWorldScale})),s=(0,i.oR)((function(t){return t.worldScale})),d=u.indexOf(s),f=l[d];return(0,e.jsxs)("span",{className:"worldSizes",children:[(0,e.jsx)("pre",{children:"World Size"}),(0,e.jsx)(o.Z,{options:l.map((function(t,n){return{value:n,label:t}})),onChange:function(t){var e=n,o=u[t.value],l=Math.round(o*a.bf);r([l,l]),i.n2.worldWidth=l,i.n2.worldHeight=l,(0,a.DL)(e,l),c(o)},value:f})]})}},2395:function(t,n,r){r.d(n,{Th:function(){return v},CO:function(){return h},e8:function(){return p}});var e=r(4051),o=r.n(e),a=r(1550),i=r(8371),u=r(9762),l=r.n(u),c=r(8824);function s(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function d(t,n,r,e,o,a,i){try{var u=t[a](i),l=u.value}catch(t){return void r(t)}u.done?n(l):Promise.resolve(l).then(e,o)}function f(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(t){if("string"==typeof t)return s(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,n):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var p=function(t){var n,r,e,o,i,u,l,s,d,f,p,h,v,m,y,g,b,w,S,x,j,R,P,A,E,O,k,T,D,M,C,N,I,Z,V=t.canvas,F=t.width,W=t.height,L=t.sands,_=t.isSnapshot,H=a({canvas:V,attributes:{preserveDrawingBuffer:_}}),K=H.texture({width:F,height:W,data:L}),U=H({frag:"precision highp float;\n#define GLSLIFY 1\nuniform float t;\nuniform sampler2D data;\nuniform vec3 colors[16];\nuniform vec3 color2s[16];\nuniform float scale;\n\nvarying vec2 uv;\n\nfloat hue2rgb(float f1, float f2, float hue) {\n  if (hue < 0.0)\n    hue += 1.0;\n  else if (hue > 1.0)\n    hue -= 1.0;\n  float res;\n  if ((6.0 * hue) < 1.0)\n    res = f1 + (f2 - f1) * 6.0 * hue;\n  else if ((2.0 * hue) < 1.0)\n    res = f2;\n  else if ((3.0 * hue) < 2.0)\n    res = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;\n  else\n    res = f1;\n  return res;\n}\n\nvec3 hsl2rgb(vec3 hsl) {\n  vec3 rgb;\n\n  if (hsl.y == 0.0) {\n    rgb = vec3(hsl.z); // Luminance\n  } else {\n    float f2;\n\n    if (hsl.z < 0.5)\n      f2 = hsl.z * (1.0 + hsl.y);\n    else\n      f2 = hsl.z + hsl.y - hsl.y * hsl.z;\n\n    float f1 = 2.0 * hsl.z - f2;\n\n    rgb.r = hue2rgb(f1, f2, hsl.x + (1.0 / 3.0));\n    rgb.g = hue2rgb(f1, f2, hsl.x);\n    rgb.b = hue2rgb(f1, f2, hsl.x - (1.0 / 3.0));\n  }\n  return rgb;\n}\n\nvec3 hsl2rgb(float h, float s, float l) { return hsl2rgb(vec3(h, s, l)); }\nvoid main() {\n  vec2 textCoord = ((uv * vec2(0.5, -0.5)) + vec2(0.5));\n  vec2 scaledTextCoord = textCoord * scale;\n  vec4 data = texture2D(data, scaledTextCoord);\n  data.gba = (data.gba * 2.55);\n  int type = int((data.r * 255.) + 0.1);\n  float hue = 0.0;\n  float saturation = 0.3;\n  float lightness = 0.8;\n  ;\n\n  float a = 1.0;\n  vec3 colordata1 = vec3(0., 0., 0.0);\n  vec3 colordata2 = vec3(0., 0., 0.0);\n  if (type == 0) {\n    colordata1 = colors[0];\n    colordata2 = color2s[0];\n  } else if (type == 1) {\n    colordata1 = colors[1];\n    colordata2 = color2s[1];\n  } else if (type == 2) {\n    colordata1 = colors[2];\n    colordata2 = color2s[2];\n  } else if (type == 3) {\n    colordata1 = colors[3];\n    colordata2 = color2s[3];\n  } else if (type == 4) {\n    colordata1 = colors[4];\n    colordata2 = color2s[4];\n  } else if (type == 5) {\n    colordata1 = colors[5];\n    colordata2 = color2s[5];\n  } else if (type == 6) {\n    colordata1 = colors[6];\n    colordata2 = color2s[6];\n  } else if (type == 7) {\n    colordata1 = colors[7];\n    colordata2 = color2s[7];\n  } else if (type == 8) {\n    colordata1 = colors[8];\n    colordata2 = color2s[8];\n  } else if (type == 9) {\n    colordata1 = colors[9];\n    colordata2 = color2s[9];\n  } else if (type == 10) {\n    colordata1 = colors[10];\n    colordata2 = color2s[10];\n  } else if (type == 11) {\n    colordata1 = colors[11];\n    colordata2 = color2s[11];\n  } else if (type == 12) {\n    colordata1 = colors[12];\n    colordata2 = color2s[12];\n  } else if (type == 13) {\n    colordata1 = colors[13];\n    colordata2 = color2s[13];\n  } else if (type == 14) {\n    colordata1 = colors[14];\n    colordata2 = color2s[14];\n  } else if (type == 15) {\n    colordata1 = colors[15];\n    colordata2 = color2s[15];\n  }\n\n  // vec3 colordata = mix(colordata1, colordata2, data.g);\n\n  // hue = colordata.r;\n  // saturation = colordata.g;\n  // lightness = colordata.b;\n//   if (abs(colordata1.r -colordata2.r)>0.5){\n// saturation = 0.;\n// }\n  // hue = mod(hue + data.g, 1.0);\n  // saturation += (data.b * .5);\n  // lightness += (data.a *.5);\n  // vec3 color = hsl2rgb(hue, saturation, lightness);\n\n  vec3 color1 = hsl2rgb( mod(colordata1.r + data.b, 1.0), colordata1.g, colordata1.b);\n  vec3 color2 = hsl2rgb(mod(colordata2.r + data.b, 1.0), colordata2.g, colordata2.b);\n\n  vec3 color = mix(color1, color2, data.g);\n\n  gl_FragColor = vec4(color, a);\n}",uniforms:{t:function(t){return t.tick},data:function(){return K({width:F,height:W,data:L})},scale:function(){return c.ZP.getState().worldWidth/F},"colors[0]":function(){return null!==(n=c.ZP.getState().colors[0])&&void 0!==n?n:[.5,.5,.5]},"colors[1]":function(){return null!==(r=c.ZP.getState().colors[1])&&void 0!==r?r:[.5,.5,.5]},"colors[2]":function(){return null!==(e=c.ZP.getState().colors[2])&&void 0!==e?e:[.5,.5,.5]},"colors[3]":function(){return null!==(o=c.ZP.getState().colors[3])&&void 0!==o?o:[.5,.5,.5]},"colors[4]":function(){return null!==(i=c.ZP.getState().colors[4])&&void 0!==i?i:[.5,.5,.5]},"colors[5]":function(){return null!==(u=c.ZP.getState().colors[5])&&void 0!==u?u:[.5,.5,.5]},"colors[6]":function(){return null!==(l=c.ZP.getState().colors[6])&&void 0!==l?l:[.5,.5,.5]},"colors[7]":function(){return null!==(s=c.ZP.getState().colors[7])&&void 0!==s?s:[.5,.5,.5]},"colors[8]":function(){return null!==(d=c.ZP.getState().colors[8])&&void 0!==d?d:[.5,.5,.5]},"colors[9]":function(){return null!==(f=c.ZP.getState().colors[9])&&void 0!==f?f:[.5,.5,.5]},"colors[10]":function(){return null!==(p=c.ZP.getState().colors[10])&&void 0!==p?p:[.5,.5,.5]},"colors[11]":function(){return null!==(h=c.ZP.getState().colors[11])&&void 0!==h?h:[.5,.5,.5]},"colors[12]":function(){return null!==(v=c.ZP.getState().colors[12])&&void 0!==v?v:[.5,.5,.5]},"colors[13]":function(){return null!==(m=c.ZP.getState().colors[13])&&void 0!==m?m:[.5,.5,.5]},"colors[14]":function(){return null!==(y=c.ZP.getState().colors[14])&&void 0!==y?y:[.5,.5,.5]},"colors[15]":function(){return null!==(g=c.ZP.getState().colors[15])&&void 0!==g?g:[.5,.5,.5]},"colors[16]":function(){return null!==(b=c.ZP.getState().colors[16])&&void 0!==b?b:[.5,.5,.5]},"color2s[0]":function(){return null!==(w=c.ZP.getState().color2s[0])&&void 0!==w?w:[.5,.5,.5]},"color2s[1]":function(){return null!==(S=c.ZP.getState().color2s[1])&&void 0!==S?S:[.5,.5,.5]},"color2s[2]":function(){return null!==(x=c.ZP.getState().color2s[2])&&void 0!==x?x:[.5,.5,.5]},"color2s[3]":function(){return null!==(j=c.ZP.getState().color2s[3])&&void 0!==j?j:[.5,.5,.5]},"color2s[4]":function(){return null!==(R=c.ZP.getState().color2s[4])&&void 0!==R?R:[.5,.5,.5]},"color2s[5]":function(){return null!==(P=c.ZP.getState().color2s[5])&&void 0!==P?P:[.5,.5,.5]},"color2s[6]":function(){return null!==(A=c.ZP.getState().color2s[6])&&void 0!==A?A:[.5,.5,.5]},"color2s[7]":function(){return null!==(E=c.ZP.getState().color2s[7])&&void 0!==E?E:[.5,.5,.5]},"color2s[8]":function(){return null!==(O=c.ZP.getState().color2s[8])&&void 0!==O?O:[.5,.5,.5]},"color2s[9]":function(){return null!==(k=c.ZP.getState().color2s[9])&&void 0!==k?k:[.5,.5,.5]},"color2s[10]":function(){return null!==(T=c.ZP.getState().color2s[10])&&void 0!==T?T:[.5,.5,.5]},"color2s[11]":function(){return null!==(D=c.ZP.getState().color2s[11])&&void 0!==D?D:[.5,.5,.5]},"color2s[12]":function(){return null!==(M=c.ZP.getState().color2s[12])&&void 0!==M?M:[.5,.5,.5]},"color2s[13]":function(){return null!==(C=c.ZP.getState().color2s[13])&&void 0!==C?C:[.5,.5,.5]},"color2s[14]":function(){return null!==(N=c.ZP.getState().color2s[14])&&void 0!==N?N:[.5,.5,.5]},"color2s[15]":function(){return null!==(I=c.ZP.getState().color2s[15])&&void 0!==I?I:[.5,.5,.5]},"color2s[16]":function(){return null!==(Z=c.ZP.getState().color2s[16])&&void 0!==Z?Z:[.5,.5,.5]},dpi:2*window.devicePixelRatio},vert:'\n// boring "pass-through" vertex shader\nprecision mediump float;\nattribute vec2 position;\nvarying vec2 uv;\nvoid main() {\n  uv = position;\n  gl_Position = vec4(position, 0, 1);\n}',attributes:{position:[[-1,4],[-1,-1],[4,-1]]},count:3});return{render:function(){H.poll(),U()},regl:H}},h=function(){var t=document.createElement("canvas");return t.width=2*i.bf,t.height=2*i.Cb,(0,p({canvas:t,width:i.bf,height:i.Cb,sands:i.KT,isSnapshot:!0}).render)(),t.toDataURL("image/png")},v=function(){var t,n=(t=o().mark((function t(){var n,r,e,a,u,s,d,h,v,m,y,g,b,w,S,x,j,R,P,A,E,O;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=c.ZP.getState().pause,c.ZP.setState({isPaused:!0}),(r=document.createElement("canvas")).width=2*i.bf,r.height=2*i.Cb,e=r.width,a=r.height,u=new(l())({workers:2,quality:4,workerScript:"/gif.worker.js",width:r.width,height:r.height}),(0,i.IQ)(),(s=document.createElement("canvas")).width=e,s.height=a,d=s.getContext("2d"),(h=document.createElement("canvas")).width=e,h.height=a,(v=h.getContext("2d")).scale(1,-1),v.translate(0,-a),m=p({canvas:r,width:i.bf,height:i.Cb,sands:i.KT,isSnapshot:!0}),y=m.render,g=m.regl,b=[],w=0;w<7;w++)g.clear({color:[1,1,1,1],depth:1,stencil:0}),y(),(0,i.Ky)(),S=new ImageData(e,a),x=new Uint8Array(S.data.buffer),g.read(x),d.clearRect(0,0,e,a),d.putImageData(S,0,0),v.clearRect(0,0,e,a),v.drawImage(s,0,0,e,a),j=v.getImageData(0,0,e,a),b.push(j);for((0,i.kW)(),b=f(b).concat(f(b.slice(1,-1).reverse())),R=0;R<b.length;R++)P=b[R],A=Math.min(Math.abs(R),Math.abs(R-6),Math.abs(R-b.length))/b.length,E=1/(A+.15)*20,u.addFrame(P,{delay:E});return O=new Promise((function(t,r){u.on("finished",(function(r){c.ZP.setState({isPaused:n}),t(r)}))})),u.render(),t.abrupt("return",O);case 29:case"end":return t.stop()}}),t)})),function(){var n=this,r=arguments;return new Promise((function(e,o){var a=t.apply(n,r);function i(t){d(a,e,o,i,u,"next",t)}function u(t){d(a,e,o,i,u,"throw",t)}i(void 0)}))});return function(){return n.apply(this,arguments)}}()},8371:function(t,n,r){r.d(n,{Pr:function(){return q},t4:function(){return E},BX:function(){return J},Yz:function(){return z},rw:function(){return I},Cb:function(){return A},aJ:function(){return F},kW:function(){return M},IQ:function(){return D},tW:function(){return C},_3:function(){return X},KT:function(){return O},DT:function(){return $},DL:function(){return Y},Ky:function(){return B},bf:function(){return P}});var e=r(8824);function o(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function a(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function i(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(t){if("string"==typeof t)return o(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(t,n):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var u,l=function(t){for(var n=t.length-1;n>0;n--){var r,e=Math.floor(Math.random()*(n+1));r=[t[e],t[n]],t[n]=r[0],t[e]=r[1]}return t},c=(a(u={},"ORDERED",(function(){for(var t=0;t<O.length;t+=4)J(t)})),a(u,"REVERSE_ORDERED",(function(){for(var t=O.length-4;t>=0;t-=4)J(t)})),a(u,"XFIRST_ORDERED",(function(){z({xFirst:!0})})),a(u,"REVERSE_ALTERNATE_ORDERED",{direction:!0,tick:function(t){if(t.direction)for(var n=0;n<O.length;n+=4)J(n);else for(var r=O.length-4;r>=0;r-=4)J(r);t.direction=!t.direction}}),a(u,"XREVERSE_ALTERNATE_ORDERED",{phase:0,phases:[{aDirection:1,bDirection:1},{aDirection:1,bDirection:-1}],tick:function(t){var n=t.phases[t.phase];z(n),t.phase++,t.phase>=t.phases.length&&(t.phase=0)}}),a(u,"XYREVERSE_ALTERNATE_ORDERED",{phase:0,phases:[{xFirst:!1,aDirection:1,bDirection:1},{xFirst:!1,aDirection:-1,bDirection:1},{xFirst:!1,aDirection:-1,bDirection:-1},{xFirst:!1,aDirection:1,bDirection:-1}],tick:function(t){var n=t.phases[t.phase];z(n),t.phase++,t.phase>=t.phases.length&&(t.phase=0)}}),a(u,"XFIRST_ALTERNATE_ORDERED",{phase:0,phases:[{xFirst:!1},{xFirst:!0}],tick:function(t){var n=t.phases[t.phase];z(n),t.phase++,t.phase>=t.phases.length&&(t.phase=0)}}),a(u,"XFIRST_REVERSE_ALTERNATE_ORDERED",{phase:0,phases:[{xFirst:!1,aDirection:1,bDirection:1},{xFirst:!1,aDirection:-1,bDirection:-1},{xFirst:!0,aDirection:1,bDirection:1},{xFirst:!0,aDirection:-1,bDirection:-1}],tick:function(t){var n=t.phases[t.phase];z(n),t.phase++,t.phase>=t.phases.length&&(t.phase=0)}}),a(u,"XFIRST_XYREVERSE_ALTERNATE_ORDERED",{xFirst:!1,xFirstTimer:0,phase:0,phases:[{aDirection:1,bDirection:1},{aDirection:-1,bDirection:1},{aDirection:-1,bDirection:-1},{aDirection:1,bDirection:-1}],tick:function(t){var n=t.phases[t.phase],r=t.xFirst;z(function(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},e=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(r).filter((function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable})))),e.forEach((function(n){a(t,n,r[n])}))}return t}({},n,{xFirst:r})),t.xFirstTimer--,t.xFirstTimer<=0&&(t.xFirstTimer=3),t.phase++,t.phase>=t.phases.length&&(t.phase=0)}}),a(u,"YSNAKE_ORDERED",{tick:function(){z({snake:!0,xFirst:!0})}}),a(u,"SNAKE_ORDERED",{phase:0,phases:[{snake:!0,xFirst:!0},{snake:!0,xFirst:!1}],tick:function(t){var n=t.phases[t.phase];z(n),t.phase++,t.phase>=t.phases.length&&(t.phase=0)}}),a(u,"SNAKE_REVERSE_ALTERNATE_ORDERED",{phase:0,phases:[{snake:!0,xFirst:!0},{snake:!0,xFirst:!1,aDirection:-1},{snake:!0,xFirst:!1},{snake:!0,xFirst:!0,aDirection:-1}],tick:function(t){var n=t.phases[t.phase];z(n),t.phase++,t.phase>=t.phases.length&&(t.phase=0)}}),a(u,"RANDOM_INDEPENDENT",(function(){for(var t=0;t<E;t++){var n=4*Math.floor(Math.random()*E);J(n)}})),a(u,"CYCLIC",{order:[],isSetup:!1,setup:function(t){for(var n=0;n<E;n++)t.order.push(4*n);l(t.order),t.isSetup=!0},tick:function(t){t.isSetup||t.setup(t);var n=!0,r=!1,e=void 0;try{for(var o,a=t.order[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var i=o.value;J(i)}}catch(t){r=!0,e=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw e}}}}),a(u,"RANDOM_CYCLIC",{order:[],isSetup:!1,setup:function(t){t.order.length=0;for(var n=e.ZP.getState(),r=n.worldWidth,o=n.worldHeight,a=0;a<r;a++)for(var i=0;i<o;i++){var u=I(a,i);t.order.push(u)}t.isSetup=!0},tick:function(t){var n=e.ZP.getState().worldCellCount;t.order.length!==n&&(t.isSetup=!1),t.isSetup||t.setup(t),l(t.order);var r=!0,o=!1,a=void 0;try{for(var i,u=t.order[Symbol.iterator]();!(r=(i=u.next()).done);r=!0){var c=i.value;J(c)}}catch(t){o=!0,a=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}}}),a(u,"BENCHMARK",{order:[],isSetup:!1,setup:function(t){t.order.length=0;for(var n=e.ZP.getState(),r=n.worldWidth,o=n.worldHeight,a=0;a<r;a++)for(var i=0;i<o;i++){var u=I(a,i);t.order.push(u)}t.isSetup=!0},tick:function(t,n){var r,o=e.ZP.getState().worldCellCount;t.order.length!==o&&(t.isSetup=!1),t.isSetup||t.setup(t);for(var a=O.slice(),u=1/0,c=-1/0,s=1/0,d=-1/0,f=1/0,p=-1/0,h=0,v=0,m=0,y=0;y<50;y++){for(var g=0,b=0,w=0,S=0;S<20;S++){var x=performance.now();l(t.order);var j=!0,R=!1,P=void 0;try{for(var A,E=t.order[Symbol.iterator]();!(j=(A=E.next()).done);j=!0){var k=A.value;J(k)}}catch(t){R=!0,P=t}finally{try{j||null==E.return||E.return()}finally{if(R)throw P}}X();var T=performance.now();n.current();var D=performance.now();g+=D-x,b+=T-x,w+=D-T}var M=g/20,C=b/20,N=w/20;u=Math.min(u,M),c=Math.max(c,M),s=Math.min(s,C),d=Math.max(d,C),f=Math.min(f,N),p=Math.max(p,N),h+=M,v+=C,m+=N;for(var I=0;I<O.length;I++)O[I]=a[I]}var Z=v/50,V=m/50,F=(c-u)/2,W=(d-s)/2,L=(p-f)/2,_=["Total:",parseFloat((h/50).toPrecision(3)),"±",parseFloat(F.toPrecision(2)),"\nUpdate:",parseFloat(Z.toPrecision(3)),"±",parseFloat(W.toPrecision(2)),"\nDraw:",parseFloat(V.toPrecision(3)),"±",parseFloat(L.toPrecision(2))];(r=console).log.apply(r,i(_)),alert(_.join(" ")),e.ZP.setState({paused:!0})}}),u);function s(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function d(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var e,o,a=[],i=!0,u=!1;try{for(r=r.call(t);!(i=(e=r.next()).done)&&(a.push(e.value),!n||a.length!==n);i=!0);}catch(t){u=!0,o=t}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(t,n)||function(t,n){if(t){if("string"==typeof t)return s(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,n):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t){return n=Math.abs((t+80)%8-4)-2,-1,1,Math.min(Math.max(n,-1),1);var n}function p(t){return f(t-2)}function h(t,n){var r=d(t,2),e=r[0],o=r[1],a=function(t){var n=d(t,2),r=n[0],e=n[1];return Math.max(Math.abs(r),Math.abs(e))}([e,o]),i=function(t){return[f(t),p(t)]}(function(t){var n=d(t,2),r=n[0],e=n[1];if(0==e)return r>0?0:4;var o=r/e;return Math.abs(o)<1?e>0?2-o:6-o:(o=e/r,r>0?o+0:4+o)}([e,o])+n);return[i[0]*a,i[1]*a]}var v=r(8630),m=r.n(v);function y(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function g(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var e,o,a=[],i=!0,u=!1;try{for(r=r.call(t);!(i=(e=r.next()).done)&&(a.push(e.value),!n||a.length!==n);i=!0);}catch(t){u=!0,o=t}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(t,n)||w(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t){return function(t){if(Array.isArray(t))return y(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||w(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(t,n){if(t){if("string"==typeof t)return y(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(t,n):void 0}}m().seed(Math.random());var S=0,x=0,j="ROTATION",R=0,P=300,A=300,E=P*A,O=new Uint8Array(4*E),k=[],T=[];function D(){k.push(O.slice(0,4*E)),k.length>45&&k.shift()}function M(){var t=k.pop();O.set(t),0===k.length&&D()}D();function C(t,n){var r=3*(0,v.simplex2)(0,e.n2.tNoise/5);return 50*(m().simplex3((t+r)/3,(n+r)/3,e.n2.tNoise/5)+1)|0}function N(t){return h(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}function I(t,n){return 4*(t+n*P)}function Z(t,n){var r=e.n2.worldWidth,o=e.n2.worldHeight;if(e.n2.wraparoundEnabled){for(;t<0;)t+=r;for(;t>=r;)t-=r;for(;n<0;)n+=o;for(;n>=o;)n-=o}return[t,n]}function V(t,n){var r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=(r=g(Z(t=Math.round(t),n=Math.round(n)),2))[0],n=r[1];var a=e.n2.worldWidth,i=e.n2.worldHeight;if(t<0||t>=a||n<0||n>=i)return 1;var u=I(t,n)+o;return O[u]}function F(t,n,r){var o=g(t,2),a=o[0],i=o[1],u=g(r,2),l=u[0],c=u[1],s=e.n2.worldWidth,d=e.n2.worldHeight;a<0||a>=s||i<0||i>=d||function(t,n,r,o,a,i){var u;t=(u=g(Z(t,n),2))[0],n=u[1];var l=e.n2.worldWidth,c=e.n2.worldHeight;if(!(t<0||t>=l||n<0||n>=c)){var s=I(t,n);void 0!==r&&(O[s]=r),void 0!==o&&(O[s+1]=o),O[s+2]=0,O[s+3]=0}}(a,i,n,C(null!=l?l:a,null!=c?c:i))}function W(t){var n,r=g(t,2),e=r[0],o=r[1],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e=(n=g((0,_[j][R])(e,o),2))[0],o=n[1],V(e+S,o+x,a)}function L(t,n){return Math.abs(t-n)}e.n2.t=0,e.n2.tNoise=0,window.sands=O;var _={ROTATION:[function(t,n){return[t,n]},function(t,n){return h([t,n],1)},function(t,n){return h([t,n],2)},function(t,n){return h([t,n],3)},function(t,n){return h([t,n],4)},function(t,n){return h([t,n],5)},function(t,n){return h([t,n],6)},function(t,n){return h([t,n],7)}],REFLECTION:[function(t,n){return[t,n]},function(t,n){return[-t,n]},function(t,n){return[t,-n]},function(t,n){return[-t,-n]}],HORIZONTAL_REFLECTION:[function(t,n){return[t,n]},function(t,n){return[-t,n]}],VERTICAL_REFLECTION:[function(t,n){return[t,n]},function(t,n){return[t,-n]}]},H=new Set([" ","ArrowRight","ArrowLeft","ArrowUp","ArrowDown"]),K={};function U(){var t=!0,n=!1,r=void 0;try{for(var e,o=H.values()[Symbol.iterator]();!(t=(e=o.next()).done);t=!0){var a=e.value;K[a]=!1}}catch(t){n=!0,r=t}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}U(),window.addEventListener("keydown",(function(t){H.has(t.key)&&(K[t.key]=!0,document.activeElement.classList.contains("simulation-button")&&t.preventDefault())}),{passive:!1}),window.addEventListener("keyup",(function(t){H.has(t.key)&&(K[t.key]=!1)}),{passive:!1}),window.addEventListener("visibilitychange",(function(t){U()})),e.n2.keys=K,e.n2.getKeyBoardVector=function(){var t=0,n=0;return K.ArrowRight&&t++,K.ArrowLeft&&t--,K.ArrowUp&&n--,K.ArrowDown&&n++,[t,n]},e.n2.getCursorDistance=function(){var t=e.oR.getState().pos;return Math.floor(Math.sqrt(Math.pow(t[0]-S,2)+Math.pow(t[1]-x,2)))},e.n2.getSandRelative=W,e.n2.setSandRelative=function(t,n,r,o,a){var i,u,l,c,s=g(t,2),d=s[0],f=s[1],p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];i=g([d,f].map((function(t){return Math.round(t)})),2),d=i[0],f=i[1],d=(u=g((0,_[j][R])(d,f),2))[0],f=u[1],l=g([n,r,o,a].map((function(t){return function(t){if(void 0!==t)return"number"==typeof t?t:"number"==typeof g(t,1)[0]?function(t){var n="Unimplemented code - please tell @TodePond or @maxbittker that you found this error :)";throw alert(n),new Error(n)}():function(t){return 1===t.length?g(t[0],1)[0]:g(t[Math.floor(Math.random()*t.length)],1)[0]}(t)}(t)})),4),n=l[0],r=l[1],o=l[2],a=l[3],d=(c=g(Z(d+=S,f+=x),2))[0],f=c[1];var h=e.n2.worldWidth,v=e.n2.worldHeight;if(!(d<0||d>=h||f<0||f>=v)){var m=I(d,f);if(void 0!==n){if(O[m]==n)return;O[m]=n,p&&(r=r||C(d,f),o=o||0,a=a||0)}void 0!==r&&(O[m+1]=r),void 0!==o&&(O[m+2]=(o+100)%100),void 0!==a&&(O[m+3]=a)}},e.n2.swapSandRelative=function(t,n,r){var o,a,i=g(t,2),u=i[0],l=i[1],c=g(n,2),s=c[0],d=c[1];o=g([u,l].map((function(t){return Math.round(t)})),2),u=o[0],l=o[1],a=g([s,d].map((function(t){return Math.round(t)})),2),s=a[0],d=a[1];var f,p,h=_[j][R],v=g(h(u,l),2),m=v[0],y=v[1],b=g(h(s,d),2),w=b[0],P=b[1],A=[S+m,x+y],E=A[0],k=A[1],T=[S+w,x+P],D=T[0],M=T[1];E=(f=g(Z(E,k),2))[0],k=f[1],D=(p=g(Z(D,M),2))[0],M=p[1];var C=e.n2.worldWidth,N=e.n2.worldHeight;if(!(E<0||E>=C||k<0||k>=N||D<0||D>=C||M<0||M>=N)){var V=I(E,k),F=I(D,M),W=O[V],L=O[V+1],H=O[V+2],K=O[V+3],U=O[F],z=O[F+1],J=O[F+2],B=O[F+3];O[V]=U,O[V+1]=z,O[V+2]=J,O[V+3]=B,O[F]=W,O[F+1]=L,O[F+2]=H,O[F+3]=K}},e.n2.cloneSandRelative=function(t,n,r){var o,a,i=g(t,2),u=i[0],l=i[1],c=g(n,2),s=c[0],d=c[1];o=g([u,l].map((function(t){return Math.round(t)})),2),u=o[0],l=o[1],a=g([s,d].map((function(t){return Math.round(t)})),2),s=a[0],d=a[1];var f,p,h=_[j][R],v=g(h(u,l),2),m=v[0],y=v[1],b=g(h(s,d),2),w=b[0],P=b[1],A=[S+m,x+y],E=A[0],k=A[1],T=[S+w,x+P],D=T[0],M=T[1];E=(f=g(Z(E,k),2))[0],k=f[1],D=(p=g(Z(D,M),2))[0],M=p[1];var C=e.n2.worldWidth,N=e.n2.worldHeight;if(!(E<0||E>=C||k<0||k>=N||D<0||D>=C||M<0||M>=N)){var V=I(E,k),F=I(D,M);O[F]=O[V],O[F+1]=O[V+1],O[F+2]=O[V+2],O[F+3]=O[V+3]}},e.n2.moveOrigin=function(t){var n,r=g(t,2),o=r[0],a=r[1],i=[S+o,x+a],u=i[0],l=i[1],c=e.n2.worldWidth,s=e.n2.worldHeight;u<0||u>=c||l<0||l>=s||(S=(n=[u,l])[0],x=n[1])},e.n2.eq=function t(n,r,e,o){if("Vector"===e&&"Vector"===o){var a=g(n,2),i=a[0],u=a[1],l=g(r,2),c=l[0],s=l[1];return i===c&&u===s}return"Group"===e?n.some((function(n){var e=g(n,2),a=e[0],i=e[1];return t(a,r,i,o)})):"Group"===o?r.some((function(r){var o=g(r,2),a=o[0],i=o[1];return t(n,a,e,i)})):n===r},e.n2.greaterThan=function(t,n,r,e){if("Vector"===r&&"Vector"===e){var o=g(t,2),a=o[0],i=o[1],u=g(n,2),l=u[0],c=u[1];return Math.hypot(a,i)>Math.hypot(l,c)}return t>n},e.n2.lessThan=function(t,n,r,e){if("Vector"===r&&"Vector"===e){var o=g(t,2),a=o[0],i=o[1],u=g(n,2),l=u[0],c=u[1];return Math.hypot(a,i)<Math.hypot(l,c)}return t<n},e.n2.isTouching=function(t,n,r){var e=g(t,2),o=e[0],a=e[1],i=[(o+=S)+1,a+=x],u=[o-1,a],l=[o,a-1],c=[o,a+1],s=[o+1,a-1],d=[o-1,a-1],f=[o+1,a+1],p=[o-1,a+1];if("Group"===r){var h=!0,v=!1,m=void 0;try{for(var y,w=n[Symbol.iterator]();!(h=(y=w.next()).done);h=!0){var j=g(y.value,1)[0];if(V.apply(void 0,b(i))===j)return!0;if(V.apply(void 0,b(u))===j)return!0;if(V.apply(void 0,b(l))===j)return!0;if(V.apply(void 0,b(c))===j)return!0;if(V.apply(void 0,b(s))===j)return!0;if(V.apply(void 0,b(d))===j)return!0;if(V.apply(void 0,b(f))===j)return!0;if(V.apply(void 0,b(p))===j)return!0}}catch(t){v=!0,m=t}finally{try{h||null==w.return||w.return()}finally{if(v)throw m}}return!1}var R=n;return V.apply(void 0,b(i))===R||V.apply(void 0,b(u))===R||V.apply(void 0,b(l))===R||V.apply(void 0,b(c))===R||V.apply(void 0,b(s))===R||V.apply(void 0,b(d))===R||V.apply(void 0,b(f))===R||V.apply(void 0,b(p))===R},e.n2.getNumberTouching=function(t,n,r){var e=g(t,2),o=e[0],a=e[1],i=[(o+=S)+1,a+=x],u=[o-1,a],l=[o,a-1],c=[o,a+1],s=[o+1,a-1],d=[o-1,a-1],f=[o+1,a+1],p=[o-1,a+1];if("Group"===r){var h=0,v=!0,m=!1,y=void 0;try{for(var w,j=n[Symbol.iterator]();!(v=(w=j.next()).done);v=!0){var R=g(w.value,1)[0];V.apply(void 0,b(i))===R&&h++,V.apply(void 0,b(u))===R&&h++,V.apply(void 0,b(l))===R&&h++,V.apply(void 0,b(c))===R&&h++,V.apply(void 0,b(s))===R&&h++,V.apply(void 0,b(d))===R&&h++,V.apply(void 0,b(f))===R&&h++,V.apply(void 0,b(p))===R&&h++}}catch(t){m=!0,y=t}finally{try{v||null==j.return||j.return()}finally{if(m)throw y}}return h}var P=0,A=n;return V.apply(void 0,b(i))===A&&P++,V.apply(void 0,b(u))===A&&P++,V.apply(void 0,b(l))===A&&P++,V.apply(void 0,b(c))===A&&P++,V.apply(void 0,b(s))===A&&P++,V.apply(void 0,b(d))===A&&P++,V.apply(void 0,b(f))===A&&P++,V.apply(void 0,b(p))===A&&P++,P},e.n2.isBlock=function(t,n,r){var e=W(t);if("Group"===r){var o=!0,a=!1,i=void 0;try{for(var u,l=n[Symbol.iterator]();!(o=(u=l.next()).done);o=!0)if(e===g(u.value,1)[0])return!0}catch(t){a=!0,i=t}finally{try{o||null==l.return||l.return()}finally{if(a)throw i}}return!1}return e===n},e.n2.add=function(t,n,r,e){if("Vector"===r&&"Vector"===e){var o=g(t,2),a=o[0],i=o[1],u=g(n,2);return[a+u[0],i+u[1]]}if("Vector"===r&&"Vector"!==e){var l,c=g(t,2),s=c[0],d=c[1];return[s=(l=g(N([s,d],-n),2))[0],d=l[1]]}if("Vector"!==r&&"Vector"===e){var f,p=g(n,2),h=p[0],v=p[1];return[h=(f=g(N([h,v],-t),2))[0],v=f[1]]}return t+n},e.n2.clamp=function(t,n,r){return t<n?n:t>r?r:t},e.n2.wrap=function(t,n,r){for(var e=r-n;t<n;)t+=e;for(;t>r;)t-=e;return t},e.n2.subtract=function(t,n,r,e){if("Vector"===r&&"Vector"===e){var o=g(t,2),a=o[0],i=o[1],u=g(n,2);return[a-u[0],i-u[1]]}if("Vector"===r&&"Vector"!==e){for(var l=g(t,2),c=l[0],s=l[1],d=0;d<n;d++){var f;c=(f=g(N([c,s],1),2))[0],s=f[1]}return[c,s]}if("Vector"!==r&&"Vector"===e){for(var p=g(n,2),h=p[0],v=p[1],m=0;m<t;m++){var y;h=(y=g(N([h,v],1),2))[0],v=y[1]}return[h,v]}return t-n},e.n2.multiply=function(t,n,r,e){if("Vector"===r&&"Vector"===e){var o=g(t,2),a=o[0],i=o[1],u=g(n,2);return[a*u[0],i*u[1]]}if("Vector"===r&&"Vector"!==e){var l=g(t,2);return[l[0]*n,l[1]*n]}if("Vector"!==r&&"Vector"===e){var c=g(n,2);return[c[0]*t,c[1]*t]}return t*n},e.n2.difference=function(t,n,r,e){if("Vector"===r&&"Vector"===e){var o=g(t,2),a=o[0],i=o[1],u=g(n,2),l=u[0],c=u[1];return[L(a,l),L(i,c)]}if("Vector"===r&&"Vector"!==e){var s=g(t,2),d=s[0],f=s[1];return[L(d,n),L(f,n)]}if("Vector"!==r&&"Vector"===e){var p=g(n,2),h=p[0],v=p[1];return[L(h,t),L(v,t)]}return L(t,n)},e.n2.divide=function(t,n,r,e){if("Vector"===r&&"Vector"===e){var o=g(t,2),a=o[0],i=o[1],u=g(n,2);return[a/u[0],i/u[1]]}if("Vector"===r&&"Vector"!==e){var l=g(t,2);return[l[0]/n,l[1]/n]}if("Vector"!==r&&"Vector"===e){var c=g(n,2);return[c[0]/t,c[1]/t]}return t/n},e.n2.mod=function(t,n,r,e){if("Vector"===r&&"Vector"===e){var o=g(t,2),a=o[0],i=o[1],u=g(n,2);return[a%u[0],i%u[1]]}if("Vector"===r&&"Vector"!==e){var l=g(t,2);return[l[0]%n,l[1]%n]}if("Vector"!==r&&"Vector"===e){var c=g(n,2);return[c[0]%t,c[1]%t]}return t%n},e.n2.setTransformation=function(t,n){j=t,R=n},e.n2.randomOffset=function(){var t=[[0,1],[-1,0],[1,0],[0,-1],[1,-1],[-1,-1],[1,1],[-1,1]];return t[Math.floor(Math.random()*t.length)]},e.n2.setRotation=function(t){j="ROTATION",R=(t+800)%8},e.n2.setRandomTransformation=function(t){var n=_[j=t];R=Math.floor(Math.random()*n.length)},e.n2.loopThroughTransformation=function(t,n){for(var r=_[j=t],e=0;e<r.length;e++)R=e,n()},e.n2.getTransformation=function(){return[j,R]},e.n2.callAfterFrame=function(t){var n={aX:S,aY:x,transformationSet:j,transformationId:R,func:t};T.push(n)};var z=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.xFirst,r=void 0!==n&&n,o=t.aDirection,a=void 0===o?1:o,i=t.bDirection,u=void 0===i?1:i,l=t.snake,c=void 0!==l&&l,s=e.n2.worldWidth,d=1===u?0:s-1,f=-1===u?0:s-1,p=1===a?function(t){return t<s}:function(t){return t>=0},h=1===u?function(t){return t<s}:function(t){return t>=0},v=-1===u?function(t){return t<s}:function(t){return t>=0},m=!1,y=1===a?0:s-1;p(y);y+=a){if(m)for(var b=f;v(b);b-=u){var w=g(r?[y,b]:[b,y],2),S=I(w[0],w[1]);J(S)}else for(var x=d;h(x);x+=u){var j=g(r?[y,x]:[x,y],2),R=I(j[0],j[1]);J(R)}c&&(m=!m)}},J=function(t){var n=t/4,r=O[t],o=n%P,a=Math.floor(n/P);S=o,x=a,j="ROTATION",R=0;var i=e.n2.updaters[r];if(void 0===i)return[];i()},B=function(t){e.n2.tNoise+=-.1,e.n2.t+=1;var n=c[e.n2.updateScheme||"RANDOM_CYCLIC"];"function"==typeof n?n(n,t):n.tick(n,t),X()},X=function(){var t=!0,n=!1,r=void 0;try{for(var e,o=T[Symbol.iterator]();!(t=(e=o.next()).done);t=!0){var a=e.value;S=a.aX,x=a.aY,j=a.transformationSet,R=a.transformationId,a.func()}}catch(t){n=!0,r=t}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}T.length=0},Y=function(t,n){var r=Math.round(Math.abs(n/2-t/2)),e=I(r,r);if(n>t){O.copyWithin(e,0,O.length);for(var o=0;o<e;o+=4){var a=o/4%P,i=Math.floor(o/4/P);O[o]=0,O[o+1]=C(a,i),O[o+2]=0,O[o+3]=0}}else{O.copyWithin(0,e,O.length);for(var u=0;u<O.length;u+=4){var l=u/4%P,c=Math.floor(u/4/P);l<n&&c<n||(O[u]=0,O[u+1]=C(l,c),O[u+2]=0,O[u+3]=0)}}},$=function(){for(var t=0;t<O.length;t+=4){var n=t/4%P,r=Math.floor(t/4/P);O[t]=0,O[t+1]=C(n,r),O[t+2]=0,O[t+3]=0}},q=function(){for(var t=e.n2.worldWidth,n=e.n2.worldHeight,r=0;r<O.length;r+=4){var o=r/4%P,a=Math.floor(r/4/P);(0===o||o===t-1||0===a||a===n-1)&&o<t&&a<n&&(O[r]=1,O[r+1]=C(o,a),O[r+2]=0,O[r+3]=0)}};!function(){for(var t=e.n2.worldWidth,n=e.n2.worldHeight,r=0;r<O.length;r+=4){var o=r/4%P,a=Math.floor(r/4/P);O[r]=(0===o||o===t-1||0===a||a===n-1)&&o<t&&a<n?1:0,O[r+1]=C(o,a),O[r+2]=0,O[r+3]=0}}()},8630:function(t,n,r){function e(t,n,r){this.x=t,this.y=n,this.z=r}t=r.nmd(t),e.prototype.dot2=function(t,n){return this.x*t+this.y*n},e.prototype.dot3=function(t,n,r){return this.x*t+this.y*n+this.z*r};var o=[new e(1,1,0),new e(-1,1,0),new e(1,-1,0),new e(-1,-1,0),new e(1,0,1),new e(-1,0,1),new e(1,0,-1),new e(-1,0,-1),new e(0,1,1),new e(0,-1,1),new e(0,1,-1),new e(0,-1,-1)],a=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],i=new Array(512),u=new Array(512);t.seed=function(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var n=0;n<256;n++){var r;r=1&n?a[n]^255&t:a[n]^t>>8&255,i[n]=i[n+256]=r,u[n]=u[n+256]=o[r%12]}},t.seed(0);var l=.5*(Math.sqrt(3)-1),c=(3-Math.sqrt(3))/6,s=1/6;function d(t){return t*t*t*(t*(6*t-15)+10)}function f(t,n,r){return(1-r)*t+r*n}t.simplex2=function(t,n){var r,e,o=(t+n)*l,a=Math.floor(t+o),s=Math.floor(n+o),d=(a+s)*c,f=t-a+d,p=n-s+d;f>p?(r=1,e=0):(r=0,e=1);var h=f-r+c,v=p-e+c,m=f-1+2*c,y=p-1+2*c,g=u[(a&=255)+i[s&=255]],b=u[a+r+i[s+e]],w=u[a+1+i[s+1]],S=.5-f*f-p*p,x=.5-h*h-v*v,j=.5-m*m-y*y;return 70*((S<0?0:(S*=S)*S*g.dot2(f,p))+(x<0?0:(x*=x)*x*b.dot2(h,v))+(j<0?0:(j*=j)*j*w.dot2(m,y)))},t.simplex3=function(t,n,r){var e,o,a,l,c,d,f=.3333333333333333*(t+n+r),p=Math.floor(t+f),h=Math.floor(n+f),v=Math.floor(r+f),m=(p+h+v)*s,y=t-p+m,g=n-h+m,b=r-v+m;y>=g?g>=b?(e=1,o=0,a=0,l=1,c=1,d=0):y>=b?(e=1,o=0,a=0,l=1,c=0,d=1):(e=0,o=0,a=1,l=1,c=0,d=1):g<b?(e=0,o=0,a=1,l=0,c=1,d=1):y<b?(e=0,o=1,a=0,l=0,c=1,d=1):(e=0,o=1,a=0,l=1,c=1,d=0);var w=y-e+s,S=g-o+s,x=b-a+s,j=y-l+2*s,R=g-c+2*s,P=b-d+2*s,A=y-1+.5,E=g-1+.5,O=b-1+.5,k=u[(p&=255)+i[(h&=255)+i[v&=255]]],T=u[p+e+i[h+o+i[v+a]]],D=u[p+l+i[h+c+i[v+d]]],M=u[p+1+i[h+1+i[v+1]]],C=.6-y*y-g*g-b*b,N=.6-w*w-S*S-x*x,I=.6-j*j-R*R-P*P,Z=.6-A*A-E*E-O*O;return 32*((C<0?0:(C*=C)*C*k.dot3(y,g,b))+(N<0?0:(N*=N)*N*T.dot3(w,S,x))+(I<0?0:(I*=I)*I*D.dot3(j,R,P))+(Z<0?0:(Z*=Z)*Z*M.dot3(A,E,O)))},t.perlin2=function(t,n){var r=Math.floor(t),e=Math.floor(n);t-=r,n-=e;var o=u[(r&=255)+i[e&=255]].dot2(t,n),a=u[r+i[e+1]].dot2(t,n-1),l=u[r+1+i[e]].dot2(t-1,n),c=u[r+1+i[e+1]].dot2(t-1,n-1),s=d(t);return f(f(o,l,s),f(a,c,s),d(n))},t.perlin3=function(t,n,r){var e=Math.floor(t),o=Math.floor(n),a=Math.floor(r);t-=e,n-=o,r-=a;var l=u[(e&=255)+i[(o&=255)+i[a&=255]]].dot3(t,n,r),c=u[e+i[o+i[a+1]]].dot3(t,n,r-1),s=u[e+i[o+1+i[a]]].dot3(t,n-1,r),p=u[e+i[o+1+i[a+1]]].dot3(t,n-1,r-1),h=u[e+1+i[o+i[a]]].dot3(t-1,n,r),v=u[e+1+i[o+i[a+1]]].dot3(t-1,n,r-1),m=u[e+1+i[o+1+i[a]]].dot3(t-1,n-1,r),y=u[e+1+i[o+1+i[a+1]]].dot3(t-1,n-1,r-1),g=d(t),b=d(n),w=d(r);return f(f(f(l,h,g),f(c,v,g),w),f(f(s,m,g),f(p,y,g),w),b)},t.exports=t}}]);